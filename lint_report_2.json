[{"filePath":"C:\\Users\\dolph\\Coding\\Antigravity\\fantasy-hockey-draft\\src\\components\\PlayerList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":648,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":648,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24879,24882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24879,24882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useLeague } from '../context/LeagueContext';\r\nimport { db } from '../firebase';\r\nimport { collection, query, where, orderBy, onSnapshot, doc, updateDoc } from 'firebase/firestore';\r\nimport { isPlayerInjuredByName } from '../services/injuryService';\r\nimport { useInjuries } from '../queries/useInjuries';\r\nimport { toast } from 'sonner';\r\nimport { GlassCard } from './ui/GlassCard';\r\nimport { cn } from '../lib/utils';\r\nimport MyPlayerCard from './roster/MyPlayerCard';\r\n\r\ninterface DraftedPlayer {\r\n  id: string;\r\n  playerId: string;\r\n  name: string;\r\n  position: string;\r\n  positionName: string;\r\n  nhlTeam: string;\r\n  jerseyNumber: number;\r\n  round: number;\r\n  pickNumber: number;\r\n  draftedBy: string;\r\n  draftedByTeam: string;\r\n  rosterSlot: 'active' | 'reserve';\r\n  pendingSlot?: 'active' | 'reserve' | null; // For pending swaps\r\n}\r\n\r\ninterface TeamScore {\r\n  id: string;\r\n  teamName: string;\r\n  totalPoints: number;\r\n}\r\n\r\nexport default function PlayerList() {\r\n  useAuth();\r\n  const { league, myTeam } = useLeague();\r\n  const [players, setPlayers] = useState<DraftedPlayer[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [sortBy, setSortBy] = useState<'points' | 'name' | 'position' | 'games'>('position');\r\n  const [filterBy, setFilterBy] = useState<'all' | 'F' | 'D' | 'G'>('all');\r\n  const [gameIdsToday, setGameIdsToday] = useState<Set<string>>(new Set());\r\n\r\n  const [selectedForSwap, setSelectedForSwap] = useState<{\r\n    playerId: string;\r\n    playerName: string;\r\n    position: string;\r\n    currentSlot: 'active' | 'reserve';\r\n  } | null>(null);\r\n\r\n  const { data: injuries = [] } = useInjuries();\r\n\r\n  // Helper to get next Saturday at 5 AM\r\n  const getNextSaturday = () => {\r\n    const d = new Date();\r\n    const today = d.getDay(); // 0 = Sunday, 6 = Saturday\r\n    const daysUntilSaturday = (6 - today + 7) % 7;\r\n\r\n    // If today is Saturday and it's already past 5 AM, move to next Saturday\r\n    if (today === 6 && d.getHours() >= 5) {\r\n      d.setDate(d.getDate() + 7);\r\n    } else if (daysUntilSaturday === 0) {\r\n      // Today is Saturday but before 5 AM, so use today\r\n      d.setDate(d.getDate());\r\n    } else {\r\n      // Add days until next Saturday\r\n      d.setDate(d.getDate() + daysUntilSaturday);\r\n    }\r\n\r\n    d.setHours(5, 0, 0, 0);\r\n    return d;\r\n  };\r\n\r\n  // Helper to get ordinal suffix\r\n  const getOrdinalSuffix = (i: number) => {\r\n    const j = i % 10,\r\n      k = i % 100;\r\n    if (j === 1 && k !== 11) {\r\n      return \"st\";\r\n    }\r\n    if (j === 2 && k !== 12) {\r\n      return \"nd\";\r\n    }\r\n    if (j === 3 && k !== 13) {\r\n      return \"rd\";\r\n    }\r\n    return \"th\";\r\n  };\r\n\r\n  // Helper to get position name\r\n  const getPositionName = (pos: string) => {\r\n    switch (pos) {\r\n      case 'C': return 'Center';\r\n      case 'L': return 'Left Wing';\r\n      case 'R': return 'Right Wing';\r\n      case 'D': return 'Defenseman';\r\n      case 'G': return 'Goalie';\r\n      default: return pos;\r\n    }\r\n  };\r\n\r\n  // Check if swap is valid (forwards can swap with any forward, D with D, G with G)\r\n  const isSwapDisabled = (player: DraftedPlayer) => {\r\n    if (!selectedForSwap) return false;\r\n\r\n    // Check if positions are compatible\r\n    const forwardPositions = ['C', 'L', 'R'];\r\n    const isPlayerForward = forwardPositions.includes(player.position);\r\n    const isSelectedForward = forwardPositions.includes(selectedForSwap.position);\r\n\r\n    // Forwards can swap with any forward, but D and G must match exactly\r\n    if (isPlayerForward && isSelectedForward) {\r\n      // Both are forwards, swap is allowed\r\n    } else if (player.position !== selectedForSwap.position) {\r\n      // Not both forwards and positions don't match\r\n      return true;\r\n    }\r\n\r\n    // Must be different roster slot\r\n    if (player.rosterSlot === selectedForSwap.currentSlot) return true;\r\n    return false;\r\n  };\r\n\r\n  // Select player for swap\r\n  const selectPlayerForSwap = (playerId: string) => {\r\n    const player = players.find(p => p.id === playerId);\r\n    if (!player) return;\r\n\r\n    if (selectedForSwap) {\r\n      // If clicking the same player, deselect\r\n      if (selectedForSwap.playerId === playerId) {\r\n        setSelectedForSwap(null);\r\n        return;\r\n      }\r\n\r\n      // If clicking a valid target, execute swap\r\n      if (!isSwapDisabled(player)) {\r\n        executeSwap(selectedForSwap.playerId, playerId);\r\n      }\r\n    } else {\r\n      // Select first player\r\n      setSelectedForSwap({\r\n        playerId: player.id,\r\n        playerName: player.name,\r\n        position: player.position,\r\n        currentSlot: player.rosterSlot\r\n      });\r\n    }\r\n  };\r\n\r\n  // Execute swap request\r\n  const executeSwap = async (player1Id: string, player2Id: string) => {\r\n    try {\r\n      // setSwapping(player1Id); // Show loading state\r\n      const player1 = players.find(p => p.id === player1Id);\r\n      const player2 = players.find(p => p.id === player2Id);\r\n\r\n      if (!player1 || !player2) return;\r\n\r\n      // Determine target slots (swap them)\r\n      const player1CurrentSlot = player1.rosterSlot || 'active';\r\n      const player2CurrentSlot = player2.rosterSlot || 'active';\r\n\r\n      // Update both players with pendingSlot\r\n      const p1Ref = doc(db, 'draftedPlayers', player1Id);\r\n      const p2Ref = doc(db, 'draftedPlayers', player2Id);\r\n\r\n      await updateDoc(p1Ref, {\r\n        pendingSlot: player2CurrentSlot // Move to other slot\r\n      });\r\n\r\n      await updateDoc(p2Ref, {\r\n        pendingSlot: player1CurrentSlot // Move to other slot\r\n      });\r\n\r\n      toast.success('Swap requested successfully!');\r\n      console.log(`Swap requested: \"${player1.name}\" ‚Üî \"${player2.name}\" will swap on ${getNextSaturday().toDateString()}`);\r\n      alert(`‚úÖ Swap requested!\\n\\n\"${player1.name}\" (${player1CurrentSlot}) ‚Üî \"${player2.name}\" (${player2CurrentSlot})\\n\\nWill apply on ${getNextSaturday().toLocaleDateString()}`);\r\n\r\n      setSelectedForSwap(null);\r\n    } catch (error) {\r\n      console.error('Error requesting swap:', error);\r\n      alert('Failed to request swap. Please try again.');\r\n    } finally {\r\n      // setSwapping(null);\r\n    }\r\n  };\r\n\r\n  // Cancel pending swap\r\n  const cancelSwap = async (playerId: string) => {\r\n    try {\r\n      // setSwapping(playerId);\r\n      const playerRef = doc(db, 'draftedPlayers', playerId);\r\n      await updateDoc(playerRef, {\r\n        pendingSlot: null\r\n      });\r\n    } catch (error) {\r\n      console.error('Error canceling swap:', error);\r\n    } finally {\r\n      // setSwapping(null);\r\n    }\r\n  };\r\n\r\n  // Count active roster by position\r\n  const countActiveRoster = () => {\r\n    const active = players.filter(p => (p.rosterSlot || 'active') === 'active');\r\n    const forwards = active.filter(p => ['C', 'L', 'R'].includes(p.position)).length;\r\n    const defense = active.filter(p => p.position === 'D').length;\r\n    const goalies = active.filter(p => p.position === 'G').length;\r\n    return { forwards, defense, goalies, total: active.length };\r\n  };\r\n\r\n  // Note: With atomic swaps, we don't need validation functions\r\n  // The swap logic ensures active roster stays at exactly 9F/6D/2G\r\n\r\n  // React Query automatically handles injury fetching and refetching!\r\n\r\n  // Real-time listener for drafted players\r\n  useEffect(() => {\r\n    if (!myTeam) {\r\n      console.log('PlayerList: No team assigned to user');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    console.log('PlayerList: Setting up listener for team:', myTeam.teamName);\r\n\r\n    // Query only players drafted by your team\r\n    const q = query(\r\n      collection(db, 'draftedPlayers'),\r\n      where('draftedByTeam', '==', myTeam.teamName),\r\n      orderBy('pickNumber', 'asc')\r\n    );\r\n\r\n    // Set up real-time listener\r\n    const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n      const playersData = querySnapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      } as DraftedPlayer));\r\n\r\n      console.log(`PlayerList: Found ${playersData.length} players for team \"${myTeam.teamName}\"`);\r\n      setPlayers(playersData);\r\n      setLoading(false);\r\n    }, (error) => {\r\n      console.error('Error listening to players:', error);\r\n      setLoading(false);\r\n    });\r\n\r\n    // Cleanup listener on unmount\r\n    return () => unsubscribe();\r\n  }, [myTeam]);\r\n\r\n  // Fetch player fantasy points (aggregated from daily scores)\r\n  const [playerPoints, setPlayerPoints] = useState<Record<number, number>>({});\r\n  const [dailyTeamTotals, setDailyTeamTotals] = useState<{ date: string; points: number }[]>([]);\r\n  const [lastGamePoints, setLastGamePoints] = useState<number>(0);\r\n  const [trend, setTrend] = useState<'up' | 'down' | 'neutral'>('neutral');\r\n\r\n  useEffect(() => {\r\n    if (!league || !myTeam) return;\r\n\r\n    const fetchPlayerPoints = async () => {\r\n      try {\r\n        // Fetch all daily scores for the league\r\n        // Note: In a production app with many seasons, you'd want to limit this query\r\n        const scoresQuery = query(\r\n          collection(db, `leagues/${league.id}/playerDailyScores`)\r\n        );\r\n\r\n        // We use getDocs here instead of onSnapshot to save reads/bandwidth\r\n        // Points only update once a day anyway\r\n        const snapshot = await import('firebase/firestore').then(mod => mod.getDocs(scoresQuery));\r\n\r\n        const pointsMap: Record<number, number> = {};\r\n        const dailyTotalsMap: Record<string, number> = {};\r\n\r\n        snapshot.docs.forEach(doc => {\r\n          const data = doc.data();\r\n          const playerId = data.playerId;\r\n          const points = data.points || 0;\r\n          const date = data.date;\r\n          const teamName = data.teamName;\r\n\r\n          // Aggregate total points per player\r\n          if (pointsMap[playerId]) {\r\n            pointsMap[playerId] += points;\r\n          } else {\r\n            pointsMap[playerId] = points;\r\n          }\r\n\r\n          // Aggregate daily totals for MY team\r\n          if (teamName === myTeam.teamName) {\r\n            if (dailyTotalsMap[date]) {\r\n              dailyTotalsMap[date] += points;\r\n            } else {\r\n              dailyTotalsMap[date] = points;\r\n            }\r\n          }\r\n        });\r\n\r\n        setPlayerPoints(pointsMap);\r\n\r\n        // Process daily totals for sparkline\r\n        const sortedDates = Object.keys(dailyTotalsMap).sort();\r\n        const totalsArray = sortedDates.map(date => ({\r\n          date,\r\n          points: dailyTotalsMap[date]\r\n        }));\r\n\r\n        // Fill in missing dates with 0 if needed, but for sparkline sparse is okay if linear\r\n        // For now, just use the days we have data\r\n        setDailyTeamTotals(totalsArray);\r\n\r\n        // Calculate trend (Last game vs game before)\r\n        if (totalsArray.length > 0) {\r\n          const last = totalsArray[totalsArray.length - 1].points;\r\n          setLastGamePoints(last);\r\n\r\n          if (totalsArray.length > 1) {\r\n            const prev = totalsArray[totalsArray.length - 2].points;\r\n            if (last > prev) setTrend('up');\r\n            else if (last < prev) setTrend('down');\r\n            else setTrend('neutral');\r\n          } else {\r\n            setTrend('neutral');\r\n          }\r\n        }\r\n\r\n      } catch (error) {\r\n        console.error('Error fetching player points:', error);\r\n      }\r\n    };\r\n\r\n    fetchPlayerPoints();\r\n  }, [league, myTeam]);\r\n\r\n  // Fetch team rank and total points\r\n  const [teamStats, setTeamStats] = useState<{ rank: number; totalPoints: number } | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!league || !myTeam) return;\r\n\r\n    const fetchTeamStats = async () => {\r\n      try {\r\n        const scoresQuery = query(\r\n          collection(db, `leagues/${league.id}/teamScores`),\r\n          orderBy('totalPoints', 'desc')\r\n        );\r\n\r\n        const snapshot = await import('firebase/firestore').then(mod => mod.getDocs(scoresQuery));\r\n        const teams = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as unknown as TeamScore));\r\n\r\n        const myTeamIndex = teams.findIndex(t => t.teamName === myTeam.teamName);\r\n\r\n        if (myTeamIndex !== -1) {\r\n          setTeamStats({\r\n            rank: myTeamIndex + 1,\r\n            totalPoints: teams[myTeamIndex].totalPoints || 0\r\n          });\r\n        } else {\r\n          // Fallback if no team score doc yet\r\n          setTeamStats({ rank: teams.length + 1, totalPoints: 0 });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching team stats:', error);\r\n      }\r\n    };\r\n\r\n    fetchTeamStats();\r\n  }, [league, myTeam]);\r\n\r\n  // Fetch today's games to identify players playing today\r\n  useEffect(() => {\r\n    if (!league || !myTeam) return;\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const liveStatsRef = collection(db, `leagues/${league.id}/liveStats`);\r\n    // We want all players playing today, not just my team, so we can see if reserve players are playing\r\n    // But for optimization, maybe just fetch all and filter in memory or just fetch for my team?\r\n    // The prompt implies we want to sort OUR roster.\r\n    // So we can query where teamName == myTeam.teamName OR we can just fetch all for the day.\r\n    // Fetching all for the day is safer to catch everyone.\r\n    const q = query(liveStatsRef);\r\n\r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      const playingToday = new Set<string>();\r\n      snapshot.docs.forEach((doc) => {\r\n        if (doc.id.startsWith(today)) {\r\n          const data = doc.data();\r\n          // We need to match by playerId. liveStats has playerId as number usually?\r\n          // DraftedPlayer has playerId as string.\r\n          playingToday.add(String(data.playerId));\r\n        }\r\n      });\r\n      setGameIdsToday(playingToday);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [league, myTeam]);\r\n\r\n  // Helper to generate sparkline path\r\n  const getSparklinePath = (data: { points: number }[], width: number, height: number) => {\r\n    if (data.length < 2) return \"\";\r\n\r\n    const maxPoints = Math.max(...data.map(d => d.points));\r\n    const minPoints = Math.min(...data.map(d => d.points));\r\n    const range = maxPoints - minPoints || 1; // Avoid divide by zero\r\n\r\n    const points = data.map((d, i) => {\r\n      const x = (i / (data.length - 1)) * width;\r\n      // Invert Y because SVG 0 is top\r\n      const normalizedY = (d.points - minPoints) / range;\r\n      const y = height - (normalizedY * height);\r\n      return `${x},${y}`;\r\n    });\r\n\r\n    // Create smooth curve (simple line for now, can be bezier)\r\n    // L = Line to\r\n    return `M ${points.join(\" L \")}`;\r\n  };\r\n\r\n  // Create area path (close the loop)\r\n  const getSparklineArea = (data: { points: number }[], width: number, height: number) => {\r\n    const linePath = getSparklinePath(data, width, height);\r\n    if (!linePath) return \"\";\r\n    return `${linePath} L ${width},${height} L 0,${height} Z`;\r\n  };\r\n\r\n  // Filter and Sort Logic\r\n  const getFilteredAndSortedPlayers = (rosterSlot: 'active' | 'reserve') => {\r\n    let filtered = players.filter(p => (p.rosterSlot || 'active') === rosterSlot);\r\n\r\n    // Filter\r\n    if (filterBy !== 'all') {\r\n      filtered = filtered.filter(p => {\r\n        if (filterBy === 'F') return ['C', 'L', 'R'].includes(p.position);\r\n        if (filterBy === 'D') return p.position === 'D';\r\n        if (filterBy === 'G') return p.position === 'G';\r\n        return true;\r\n      });\r\n    }\r\n\r\n    // Sort\r\n    return filtered.sort((a, b) => {\r\n      // Always put selected player at top if in swap mode? No, keep sort order.\r\n\r\n      if (sortBy === 'points') {\r\n        const pointsA = playerPoints[Number(a.playerId)] || 0;\r\n        const pointsB = playerPoints[Number(b.playerId)] || 0;\r\n        return pointsB - pointsA; // Descending\r\n      }\r\n\r\n      if (sortBy === 'name') {\r\n        return a.name.localeCompare(b.name);\r\n      }\r\n\r\n      if (sortBy === 'games') {\r\n        const aPlaying = gameIdsToday.has(a.playerId) ? 1 : 0;\r\n        const bPlaying = gameIdsToday.has(b.playerId) ? 1 : 0;\r\n        if (aPlaying !== bPlaying) return bPlaying - aPlaying; // Playing first\r\n      }\r\n\r\n      // Default / Fallback to Position sort\r\n      const getPositionOrder = (pos: string) => {\r\n        if (['C', 'L', 'R'].includes(pos)) return 1;\r\n        if (pos === 'D') return 2;\r\n        if (pos === 'G') return 3;\r\n        return 4;\r\n      };\r\n\r\n      const orderDiff = getPositionOrder(a.position) - getPositionOrder(b.position);\r\n      if (orderDiff !== 0) return orderDiff;\r\n\r\n      return a.pickNumber - b.pickNumber;\r\n    });\r\n  };\r\n\r\n  const activePlayers = getFilteredAndSortedPlayers('active');\r\n  const reservePlayers = getFilteredAndSortedPlayers('reserve');\r\n\r\n  const rosterCounts = countActiveRoster();\r\n  const nextSaturday = getNextSaturday();\r\n\r\n  // Show message if no league or team\r\n  if (!league || !myTeam) {\r\n    return (\r\n      <div className=\"max-w-[1600px] mx-auto p-6\">\r\n        <h2 className=\"text-3xl font-bold mb-6 text-white\">My Players</h2>\r\n        <GlassCard className=\"p-8 text-center\">\r\n          <p className=\"text-gray-400 text-lg\">No league found. Create or join a league to see your roster.</p>\r\n        </GlassCard>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-[1600px] mx-auto p-6\">\r\n      {/* Header Section */}\r\n      <div className=\"flex flex-col items-center justify-center mb-8 relative\">\r\n        <h2 className=\"text-4xl font-black text-white uppercase tracking-widest mb-2 text-center drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]\">\r\n          {myTeam.teamName}'s Roster\r\n        </h2>\r\n\r\n        {/* Rank & Points Badge - Performance Dashboard */}\r\n        {teamStats && (\r\n          <div className=\"w-full max-w-3xl mx-auto mb-8\">\r\n            <div className=\"relative overflow-hidden rounded-3xl bg-gradient-to-b from-slate-900/90 to-slate-900/50 border border-white/10 backdrop-blur-xl shadow-[0_0_40px_rgba(0,0,0,0.6)]\">\r\n\r\n              {/* Background Sparkline */}\r\n              <div className=\"absolute inset-0 opacity-20 pointer-events-none\">\r\n                {dailyTeamTotals.length > 1 && (\r\n                  <svg className=\"w-full h-full\" preserveAspectRatio=\"none\" viewBox={`0 0 1000 100`}>\r\n                    <defs>\r\n                      <linearGradient id=\"sparkGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                        <stop offset=\"0%\" stopColor=\"#22d3ee\" stopOpacity=\"0.5\" />\r\n                        <stop offset=\"100%\" stopColor=\"#22d3ee\" stopOpacity=\"0\" />\r\n                      </linearGradient>\r\n                    </defs>\r\n                    <path\r\n                      d={getSparklineArea(dailyTeamTotals, 1000, 100)}\r\n                      fill=\"url(#sparkGradient)\"\r\n                    />\r\n                    <path\r\n                      d={getSparklinePath(dailyTeamTotals, 1000, 100)}\r\n                      fill=\"none\"\r\n                      stroke=\"#22d3ee\"\r\n                      strokeWidth=\"2\"\r\n                    />\r\n                  </svg>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"relative z-10 px-10 py-6 flex items-center justify-between\">\r\n\r\n                {/* Total Points Section */}\r\n                <div className=\"flex flex-col items-center flex-1 border-r border-white/10\">\r\n                  <span className=\"text-xs text-cyan-200/70 uppercase tracking-[0.2em] font-bold mb-1\">Season Points</span>\r\n                  <div className=\"flex items-baseline gap-2\">\r\n                    <span className=\"text-5xl font-black text-white drop-shadow-[0_0_15px_rgba(34,211,238,0.5)]\">\r\n                      {teamStats.totalPoints.toLocaleString()}\r\n                    </span>\r\n                    {lastGamePoints > 0 && (\r\n                      <div className={cn(\r\n                        \"flex items-center text-sm font-bold px-2 py-0.5 rounded-full\",\r\n                        trend === 'up' ? \"text-green-400 bg-green-500/10\" :\r\n                          trend === 'down' ? \"text-red-400 bg-red-500/10\" : \"text-gray-400 bg-gray-500/10\"\r\n                      )}>\r\n                        <span>{trend === 'up' ? '‚ñ≤' : trend === 'down' ? '‚ñº' : '‚Ä¢'}</span>\r\n                        <span className=\"ml-1\">{lastGamePoints.toFixed(1)}</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <span className=\"text-[10px] text-gray-500 mt-1 font-medium\">\r\n                    {dailyTeamTotals.length > 0 ? 'Last Game Points' : 'No games played yet'}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Rank Section */}\r\n                <div className=\"flex flex-col items-center flex-1\">\r\n                  <span className=\"text-xs text-green-200/70 uppercase tracking-[0.2em] font-bold mb-1\">League Rank</span>\r\n                  <div className=\"flex items-baseline gap-2\">\r\n                    <span className=\"text-5xl font-black text-white drop-shadow-[0_0_15px_rgba(74,222,128,0.5)]\">\r\n                      {teamStats.rank}<sup className=\"text-2xl align-top opacity-60\">{getOrdinalSuffix(teamStats.rank)}</sup>\r\n                    </span>\r\n                  </div>\r\n                  <span className=\"text-[10px] text-gray-500 mt-1 font-medium\">\r\n                    {teamStats.rank === 1 ? 'League Leader üëë' : `Top ${Math.round((teamStats.rank / 12) * 100)}% of League`}\r\n                  </span>\r\n                </div>\r\n\r\n              </div>\r\n\r\n              {/* Bottom accent line */}\r\n              <div className=\"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-blue-500 to-green-500 opacity-50\"></div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Roster Lock Info */}\r\n      <div className=\"bg-blue-900/30 border border-blue-500/30 p-4 rounded-lg mb-4 max-w-4xl mx-auto\">\r\n        <p className=\"text-blue-200 text-sm text-center\">\r\n          üìÖ <strong>Next Roster Lock:</strong> {nextSaturday.toLocaleString()}\r\n          <span className=\"ml-2 text-gray-400\">‚Ä¢ Pending swaps will apply then</span>\r\n        </p>\r\n      </div>\r\n\r\n      {/* Swap Instructions */}\r\n      {selectedForSwap && (\r\n        <div className=\"bg-yellow-900/30 border-2 border-yellow-500 p-4 rounded-lg mb-4 max-w-4xl mx-auto\">\r\n          <p className=\"text-yellow-200 font-semibold mb-2\">\r\n            üîÑ Swap Mode Active\r\n          </p>\r\n          <p className=\"text-yellow-100 text-sm mb-2\">\r\n            Selected: <strong>{selectedForSwap.playerName}</strong> ({getPositionName(selectedForSwap.position)})\r\n            {' '}in <strong>{selectedForSwap.currentSlot}</strong> roster\r\n          </p>\r\n          <p className=\"text-gray-300 text-sm\">\r\n            Now select a <strong>{getPositionName(selectedForSwap.position)}</strong> from the{' '}\r\n            <strong>{selectedForSwap.currentSlot === 'active' ? 'Reserve' : 'Active'}</strong> roster to swap with.\r\n          </p>\r\n          <button\r\n            onClick={() => setSelectedForSwap(null)}\r\n            className=\"mt-2 bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm\"\r\n          >\r\n            Cancel Selection\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Sort & Filter Controls */}\r\n      <div className=\"max-w-4xl mx-auto mb-6 flex flex-col md:flex-row gap-4 justify-between items-center bg-slate-900/40 p-4 rounded-xl border border-white/5 backdrop-blur-md\">\r\n\r\n        {/* Filter Controls */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-xs font-bold text-gray-400 uppercase tracking-wider mr-2\">Filter:</span>\r\n          <div className=\"flex bg-slate-800/50 rounded-lg p-1 border border-white/5\">\r\n            {(['all', 'F', 'D', 'G'] as const).map((filter) => (\r\n              <button\r\n                key={filter}\r\n                onClick={() => setFilterBy(filter)}\r\n                className={cn(\r\n                  \"px-4 py-1.5 rounded-md text-xs font-bold uppercase transition-all\",\r\n                  filterBy === filter\r\n                    ? \"bg-blue-500 text-white shadow-lg shadow-blue-500/20\"\r\n                    : \"text-gray-400 hover:text-white hover:bg-white/5\"\r\n                )}\r\n              >\r\n                {filter === 'all' ? 'All' : filter}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Sort Controls */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-xs font-bold text-gray-400 uppercase tracking-wider mr-2\">Sort By:</span>\r\n          <div className=\"flex bg-slate-800/50 rounded-lg p-1 border border-white/5\">\r\n            {[\r\n              { id: 'points', label: 'Points' },\r\n              { id: 'name', label: 'Name' },\r\n              { id: 'position', label: 'Pos' },\r\n              { id: 'games', label: 'Games Today' }\r\n            ].map((sort) => (\r\n              <button\r\n                key={sort.id}\r\n                onClick={() => setSortBy(sort.id as any)}\r\n                className={cn(\r\n                  \"px-3 py-1.5 rounded-md text-xs font-bold uppercase transition-all\",\r\n                  sortBy === sort.id\r\n                    ? \"bg-purple-500 text-white shadow-lg shadow-purple-500/20\"\r\n                    : \"text-gray-400 hover:text-white hover:bg-white/5\"\r\n                )}\r\n              >\r\n                {sort.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      {/* Active Roster */}\r\n      <GlassCard className=\"p-6 mb-6 bg-gray-900/40 border-gray-700/30 backdrop-blur-md\">\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h3 className=\"text-2xl font-bold text-white flex items-center gap-3\">\r\n            <span className=\"bg-green-500/20 text-green-400 p-2 rounded-lg shadow-[0_0_15px_rgba(74,222,128,0.2)]\">üèí</span>\r\n            Active Roster\r\n            <span className=\"text-gray-500 text-lg font-normal\">({activePlayers.length})</span>\r\n          </h3>\r\n          {league?.rosterSettings && (\r\n            <div className=\"flex gap-3 text-sm bg-gray-800/50 p-2 rounded-lg border border-gray-700/50\">\r\n              <div className={cn(\"px-3 py-1 rounded-md flex items-center gap-2\", rosterCounts.forwards >= league.rosterSettings.forwards ? 'bg-blue-500/10 text-blue-400 border border-blue-500/20' : 'text-gray-400')}>\r\n                <span className=\"font-bold\">F</span> {rosterCounts.forwards}/{league.rosterSettings.forwards}\r\n              </div>\r\n              <div className={cn(\"px-3 py-1 rounded-md flex items-center gap-2\", rosterCounts.defense >= league.rosterSettings.defensemen ? 'bg-green-500/10 text-green-400 border border-green-500/20' : 'text-gray-400')}>\r\n                <span className=\"font-bold\">D</span> {rosterCounts.defense}/{league.rosterSettings.defensemen}\r\n              </div>\r\n              <div className={cn(\"px-3 py-1 rounded-md flex items-center gap-2\", rosterCounts.goalies >= league.rosterSettings.goalies ? 'bg-yellow-500/10 text-yellow-400 border border-yellow-500/20' : 'text-gray-400')}>\r\n                <span className=\"font-bold\">G</span> {rosterCounts.goalies}/{league.rosterSettings.goalies}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10 animate-pulse\">\r\n            {[1, 2, 3, 4].map(i => (\r\n              <div key={i} className=\"h-48 bg-gray-800/50 rounded-xl\"></div>\r\n            ))}\r\n          </div>\r\n        ) : activePlayers.length === 0 ? (\r\n          <div className=\"text-center py-12 border-2 border-dashed border-gray-700/50 rounded-xl\">\r\n            <p className=\"text-gray-400\">No active roster players yet.</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10\">\r\n            {activePlayers.map((player) => (\r\n              <MyPlayerCard\r\n                key={player.id}\r\n                player={player}\r\n                fantasyPoints={playerPoints[Number(player.playerId)] || 0}\r\n                injury={isPlayerInjuredByName(player.name, injuries) || undefined}\r\n                isSwapMode={selectedForSwap !== null}\r\n                isSelected={selectedForSwap?.playerId === player.id}\r\n                isSwapDisabled={isSwapDisabled(player)}\r\n                onSelect={selectPlayerForSwap}\r\n                onCancelSwap={cancelSwap}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </GlassCard>\r\n\r\n      {/* Reserve Roster */}\r\n      <GlassCard className=\"p-6 bg-gray-900/40 border-gray-700/30 backdrop-blur-md\">\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h3 className=\"text-2xl font-bold text-white flex items-center gap-3\">\r\n            <span className=\"bg-yellow-500/20 text-yellow-400 p-2 rounded-lg\">üíº</span>\r\n            Reserve Roster\r\n            <span className=\"text-gray-500 text-lg font-normal\">({reservePlayers.length})</span>\r\n          </h3>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10 animate-pulse\">\r\n            {[1, 2].map(i => (\r\n              <div key={i} className=\"h-48 bg-gray-800/50 rounded-xl\"></div>\r\n            ))}\r\n          </div>\r\n        ) : players.length === 0 ? (\r\n          <p className=\"text-gray-400\">\r\n            No players drafted yet. Go to the \"NHL Rosters\" tab and click \"Draft Player\" on any player!\r\n          </p>\r\n        ) : reservePlayers.length === 0 ? (\r\n          <div className=\"text-center py-12 border-2 border-dashed border-gray-700/50 rounded-xl\">\r\n            <p className=\"text-gray-400\">No reserve players. All players are on active roster.</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10\">\r\n            {reservePlayers.map((player) => (\r\n              <MyPlayerCard\r\n                key={player.id}\r\n                player={player}\r\n                fantasyPoints={playerPoints[Number(player.playerId)] || 0}\r\n                injury={isPlayerInjuredByName(player.name, injuries) || undefined}\r\n                isSwapMode={selectedForSwap !== null}\r\n                isSelected={selectedForSwap?.playerId === player.id}\r\n                isSwapDisabled={isSwapDisabled(player)}\r\n                onSelect={selectPlayerForSwap}\r\n                onCancelSwap={cancelSwap}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </GlassCard>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]}]